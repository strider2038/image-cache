parameters:
    app.debug: false

services:
    # external
    filesystem:
        class: Symfony\Component\Filesystem\Filesystem

    # core components
    stream_factory:
        class: Strider2038\ImgCache\Core\Streaming\StreamFactory

    file_operations:
        class: Strider2038\ImgCache\Core\FileOperations
        arguments:
            - '@filesystem'
            - '@stream_factory'
        calls:
            - [setLogger, ['@logger']]

    error_handler:
        class: Strider2038\ImgCache\Core\ErrorHandler

    # core http components
    request_factory:
        class: Strider2038\ImgCache\Core\Http\RequestFactory
        arguments:
            - '@stream_factory'

    request:
        factory:
            - '@request_factory'
            - 'createRequest'
        arguments:
            - '%server_configuration%'

    response_sender:
        class: Strider2038\ImgCache\Core\Http\ResponseSender

    response_factory:
        class: Strider2038\ImgCache\Core\Http\ResponseFactory
        arguments:
            - '@request'
            - '@stream_factory'
            - '@file_operations'
            - '%app.debug%'

    Strider2038\ImgCache\Core\CoreServicesContainerInterface:
        class: Strider2038\ImgCache\Core\CoreServicesContainer
        arguments:
            - '@logger'
            - '@service_loader'

    Strider2038\ImgCache\Core\HttpServicesContainerInterface:
        class: Strider2038\ImgCache\Core\HttpServicesContainer
        arguments:
            - '@request'
            - '@http_request_handler'
            - '@response_sender'
